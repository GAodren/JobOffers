<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Offers - Aodren</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        /* Header */
        .header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stats {
            display: flex;
            gap: 1.5rem;
        }

        .stat {
            text-align: center;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6366f1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .saved-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .saved-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .saved-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Filters */
        .filters-section {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            background: rgba(30, 41, 59, 0.5);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex: 1;
            min-width: 180px;
        }

        .filter-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-select, .filter-input {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:hover, .filter-input:hover {
            border-color: #6366f1;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Main Content */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 2rem;
        }

        /* Jobs Grid */
        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        /* Job Card */
        .job-card {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #a855f7);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .job-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .job-card:hover::before {
            opacity: 1;
        }

        .job-card.is-saved {
            border-color: rgba(16, 185, 129, 0.5);
        }

        .job-card.is-saved::before {
            background: linear-gradient(90deg, #10b981, #059669);
            opacity: 1;
        }

        .job-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .job-score {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .score-high {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .score-medium {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .score-low {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .saved-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .job-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .job-company {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a855f7;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .job-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .job-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .job-tag {
            background: rgba(99, 102, 241, 0.15);
            color: #a5b4fc;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .job-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .job-salary {
            color: #22c55e;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .job-date {
            color: #64748b;
            font-size: 0.8rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            padding: 2rem;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: #1e293b;
            border-radius: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            background: #1e293b;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #94a3b8;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.25rem;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
        }

        .modal-section-content {
            color: #cbd5e1;
            line-height: 1.6;
        }

        .modal-points {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .point-positive, .point-negative {
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .point-positive {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid #22c55e;
            color: #86efac;
        }

        .point-negative {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            color: #fca5a5;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Saved Page */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: #e2e8f0;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state-title {
            font-size: 1.25rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-right {
                width: 100%;
                flex-direction: column;
                gap: 1rem;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .saved-btn {
                width: 100%;
                justify-content: center;
            }

            .jobs-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.7);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üíº</div>
                <h1>Job Offers</h1>
            </div>
            <div class="header-right">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="totalJobs">0</div>
                        <div class="stat-label">Offres</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="avgScore">0</div>
                        <div class="stat-label">Score Moy.</div>
                    </div>
                </div>
                <button class="saved-btn" id="showSavedBtn">
                    ‚≠ê Mes offres accept√©es
                    <span class="saved-count" id="savedCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Page -->
    <div class="page active" id="mainPage">
        <!-- Filters -->
        <section class="filters-section">
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Rechercher</label>
                    <input type="text" class="filter-input" id="searchFilter" placeholder="Titre, entreprise...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ville</label>
                    <select class="filter-select" id="locationFilter">
                        <option value="">Toutes les villes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Trier par score</label>
                    <select class="filter-select" id="scoreSort">
                        <option value="">Par d√©faut</option>
                        <option value="desc">Score d√©croissant</option>
                        <option value="asc">Score croissant</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Trier par date</label>
                    <select class="filter-select" id="dateSort">
                        <option value="">Par d√©faut</option>
                        <option value="desc">Plus r√©cent</option>
                        <option value="asc">Plus ancien</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main">
            <div class="jobs-grid" id="jobsGrid">
                <!-- Jobs will be inserted here -->
            </div>
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon">üîç</div>
                <div class="empty-state-title">Aucune offre trouv√©e</div>
                <p>Essayez de modifier vos filtres</p>
            </div>
        </main>
    </div>

    <!-- Saved Page -->
    <div class="page" id="savedPage">
        <section class="filters-section">
            <div class="page-header">
                <button class="back-btn" id="backBtn">
                    ‚Üê Retour
                </button>
                <h2 class="page-title">‚≠ê Mes offres accept√©es</h2>
            </div>
        </section>

        <main class="main">
            <div class="jobs-grid" id="savedJobsGrid">
                <!-- Saved jobs will be inserted here -->
            </div>
            <div class="empty-state" id="savedEmptyState" style="display: none;">
                <div class="empty-state-icon">‚≠ê</div>
                <div class="empty-state-title">Aucune offre accept√©e</div>
                <p>Cliquez sur "Accepter" sur une offre pour la sauvegarder ici</p>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h2 class="job-title" id="modalTitle"></h2>
                    <div class="job-company" id="modalCompany"></div>
                    <div class="job-location" id="modalLocation"></div>
                </div>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="modal-section-title">Informations</div>
                    <div class="modal-section-content">
                        <p><strong>Type de contrat:</strong> <span id="modalContract"></span></p>
                        <p><strong>Exp√©rience:</strong> <span id="modalExperience"></span></p>
                        <p><strong>Salaire:</strong> <span id="modalSalary"></span></p>
                        <p><strong>Stack:</strong> <span id="modalStack"></span></p>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Points positifs</div>
                    <div class="modal-points" id="modalPositives"></div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Points n√©gatifs</div>
                    <div class="modal-points" id="modalNegatives"></div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Commentaire</div>
                    <div class="modal-section-content" id="modalComment"></div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" id="modalApplyBtn" target="_blank">
                    üöÄ Postuler
                </a>
                <button class="btn btn-success" id="modalSaveBtn">
                    ‚≠ê Accepter
                </button>
                <a href="#" class="btn btn-secondary" id="modalCompanyBtn" target="_blank">
                    üè¢ Voir l'entreprise
                </a>
            </div>
        </div>
    </div>

    <script>
        // State
        let jobs = [];
        let savedJobs = [];
        let currentJobId = null;

        // Load saved jobs from localStorage
        function loadSavedJobs() {
            const saved = localStorage.getItem('savedJobs');
            if (saved) {
                savedJobs = JSON.parse(saved);
            }
        }

        // Save jobs to localStorage
        function saveSavedJobs() {
            localStorage.setItem('savedJobs', JSON.stringify(savedJobs));
        }

        // Check if job is saved
        function isJobSaved(jobId) {
            return savedJobs.some(job => job.id === jobId);
        }

        // Add job to saved
        function saveJob(jobId) {
            const job = jobs.find(j => j.id === jobId);
            if (job && !isJobSaved(jobId)) {
                savedJobs.push(job);
                saveSavedJobs();
                updateUI();
            }
        }

        // Remove job from saved
        function unsaveJob(jobId) {
            savedJobs = savedJobs.filter(job => job.id !== jobId);
            saveSavedJobs();
            updateUI();
        }

        // Get score class
        function getScoreClass(score) {
            if (score >= 8) return 'score-high';
            if (score >= 5) return 'score-medium';
            return 'score-low';
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
        }

        // Render job card
        function renderJobCard(job, showRemoveBtn = false) {
            const isSaved = isJobSaved(job.id);
            const stackTags = job.stack.split(',').slice(0, 3).map(s => 
                `<span class="job-tag">${s.trim()}</span>`
            ).join('');

            return `
                <div class="job-card ${isSaved ? 'is-saved' : ''}" data-job-id="${job.id}">
                    <div class="job-card-header">
                        <div class="job-score ${getScoreClass(job.score)}">${job.score}</div>
                        ${isSaved ? '<span class="saved-badge">‚≠ê Accept√©e</span>' : ''}
                    </div>
                    <h3 class="job-title">${job.titre}</h3>
                    <div class="job-company">üè¢ ${job.entreprise}</div>
                    <div class="job-location">üìç ${job.localisation}</div>
                    <div class="job-tags">${stackTags}</div>
                    <div class="job-footer">
                        <span class="job-salary">${job.salaire !== 'Non pr√©cis√©' ? 'üí∞ ' + job.salaire : ''}</span>
                        <span class="job-date">${formatDate(job.date_publication)}</span>
                    </div>
                </div>
            `;
        }

        // Get filtered and sorted jobs
        function getFilteredJobs() {
            const search = document.getElementById('searchFilter').value.toLowerCase();
            const location = document.getElementById('locationFilter').value;
            const scoreSort = document.getElementById('scoreSort').value;
            const dateSort = document.getElementById('dateSort').value;

            let filtered = jobs.filter(job => {
                const matchesSearch = !search || 
                    job.titre.toLowerCase().includes(search) || 
                    job.entreprise.toLowerCase().includes(search) ||
                    job.stack.toLowerCase().includes(search);
                const matchesLocation = !location || job.localisation.includes(location);

                return matchesSearch && matchesLocation;
            });

            // Sort by score
            if (scoreSort === 'desc') {
                filtered.sort((a, b) => b.score - a.score);
            } else if (scoreSort === 'asc') {
                filtered.sort((a, b) => a.score - b.score);
            }

            // Sort by date (overrides score sort if selected)
            if (dateSort === 'desc') {
                filtered.sort((a, b) => new Date(b.date_publication) - new Date(a.date_publication));
            } else if (dateSort === 'asc') {
                filtered.sort((a, b) => new Date(a.date_publication) - new Date(b.date_publication));
            }

            return filtered;
        }

        // Render jobs
        function renderJobs() {
            const grid = document.getElementById('jobsGrid');
            const emptyState = document.getElementById('emptyState');
            const filteredJobs = getFilteredJobs();

            if (filteredJobs.length === 0) {
                grid.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                grid.innerHTML = filteredJobs.map(job => renderJobCard(job)).join('');

                // Add click listeners
                document.querySelectorAll('#jobsGrid .job-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const jobId = card.dataset.jobId;
                        openModal(jobId, false);
                    });
                });
            }
        }

        // Render saved jobs
        function renderSavedJobs() {
            const grid = document.getElementById('savedJobsGrid');
            const emptyState = document.getElementById('savedEmptyState');

            if (savedJobs.length === 0) {
                grid.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                grid.innerHTML = savedJobs.map(job => renderJobCard(job, true)).join('');

                // Add click listeners
                document.querySelectorAll('#savedJobsGrid .job-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const jobId = card.dataset.jobId;
                        openModal(jobId, true);
                    });
                });
            }
        }

        // Populate location filter
        function populateLocationFilter() {
            const locations = [...new Set(jobs.map(job => {
                const parts = job.localisation.split(',');
                return parts[0].trim();
            }))];

            const select = document.getElementById('locationFilter');
            select.innerHTML = '<option value="">Toutes les villes</option>';
            locations.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc;
                option.textContent = loc;
                select.appendChild(option);
            });
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalJobs').textContent = jobs.length;
            document.getElementById('savedCount').textContent = savedJobs.length;

            const avgScore = jobs.length > 0 
                ? (jobs.reduce((sum, job) => sum + job.score, 0) / jobs.length).toFixed(1)
                : 0;
            document.getElementById('avgScore').textContent = avgScore;
        }

        // Update UI
        function updateUI() {
            renderJobs();
            renderSavedJobs();
            updateStats();
        }

        // Open modal
        function openModal(jobId, fromSavedPage) {
            const job = fromSavedPage 
                ? savedJobs.find(j => j.id === jobId)
                : jobs.find(j => j.id === jobId);
            if (!job) return;

            currentJobId = jobId;

            document.getElementById('modalTitle').textContent = job.titre;
            document.getElementById('modalCompany').innerHTML = `üè¢ ${job.entreprise}`;
            document.getElementById('modalLocation').innerHTML = `üìç ${job.localisation}`;
            document.getElementById('modalContract').textContent = job.type_contrat;
            document.getElementById('modalExperience').textContent = job.experience_requise;
            document.getElementById('modalSalary').textContent = job.salaire;
            document.getElementById('modalStack').textContent = job.stack;
            document.getElementById('modalComment').textContent = job.commentaire;
            document.getElementById('modalApplyBtn').href = job.lien;
            document.getElementById('modalCompanyBtn').href = job.entreprise_url;

            // Positives
            const positivesHtml = job.points_positifs.map(p => 
                `<div class="point-positive">‚úì ${p}</div>`
            ).join('');
            document.getElementById('modalPositives').innerHTML = positivesHtml || '<p style="color: #64748b;">Aucun</p>';

            // Negatives
            const negativesHtml = job.points_negatifs.map(p => 
                `<div class="point-negative">‚úó ${p}</div>`
            ).join('');
            document.getElementById('modalNegatives').innerHTML = negativesHtml || '<p style="color: #64748b;">Aucun</p>';

            // Save/Unsave button
            const saveBtn = document.getElementById('modalSaveBtn');
            if (isJobSaved(jobId)) {
                saveBtn.textContent = '‚ùå Retirer';
                saveBtn.className = 'btn btn-danger';
                saveBtn.onclick = () => {
                    unsaveJob(jobId);
                    closeModal();
                };
            } else {
                saveBtn.textContent = '‚≠ê Accepter';
                saveBtn.className = 'btn btn-success';
                saveBtn.onclick = () => {
                    saveJob(jobId);
                    closeModal();
                };
            }

            document.getElementById('modalOverlay').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            currentJobId = null;
        }

        // Show saved page
        function showSavedPage() {
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('savedPage').classList.add('active');
            renderSavedJobs();
        }

        // Show main page
        function showMainPage() {
            document.getElementById('savedPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
        }

        // Initialize
        async function init() {
            loadSavedJobs();

            // Load from jobs.json
            try {
                const response = await fetch('jobs.json');
                if (response.ok) {
                    jobs = await response.json();
                }
            } catch (e) {
                console.error('Erreur chargement jobs.json:', e);
                jobs = [];
            }

            // Ensure all jobs have an id
            jobs = jobs.map((job, index) => ({
                ...job,
                id: job.id || job.lien || String(index + 1)
            }));

            populateLocationFilter();
            updateUI();

            // Filter listeners
            document.getElementById('searchFilter').addEventListener('input', renderJobs);
            document.getElementById('locationFilter').addEventListener('change', renderJobs);
            document.getElementById('scoreSort').addEventListener('change', renderJobs);
            document.getElementById('dateSort').addEventListener('change', renderJobs);

            // Modal listeners
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target === document.getElementById('modalOverlay')) {
                    closeModal();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });

            // Page navigation
            document.getElementById('showSavedBtn').addEventListener('click', showSavedPage);
            document.getElementById('backBtn').addEventListener('click', showMainPage);
        }

        init();
    </script>
</body>
</html>
